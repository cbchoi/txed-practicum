# 학생 실습 모니터링 시스템 인수 테스트

## 테스트 개요
이 문서는 학생 실습 모니터링 시스템의 인수 테스트 시나리오를 정의합니다. 모든 테스트는 실제 사용 환경을 시뮬레이션하여 시스템의 기능적/비기능적 요구사항 충족을 검증합니다.

---

## 테스트 환경 설정

### 전제 조건
- Python 3.8 이상
- Git 설치 및 구성
- GitHub 액세스 토큰 (GITHUB_TOKEN 환경 변수)
- 최소 1GB 사용 가능한 디스크 공간
- 네트워크 연결

### 테스트 데이터 준비
```csv
# test_roster.csv (id,git_id 형태)
id,git_id
S20211001,testuser1
S20211002,testuser2
S20211003,testuser3
S20211004,nonexistent
S20211005,testuser4
```

```csv
# test_process_list.csv (유틸리티로 생성됨)
id,repository_url
S20211001,https://github.com/HBNU-COME2201/software-design-practicum-testuser1
S20211002,https://github.com/HBNU-COME2201/software-design-practicum-testuser2
S20211003,https://github.com/HBNU-COME2201/software-design-practicum-testuser3
S20211004,https://github.com/HBNU-COME2201/software-design-practicum-nonexistent
S20211005,https://github.com/HBNU-COME2201/software-design-practicum-testuser4
```

---

## 기능 테스트

### TC001: 부트스트랩 프로세스 테스트

#### 목적
초기 학생 디렉터리 설정이 올바르게 수행되는지 검증

#### 전제 조건
- process_list.csv 파일 존재 (유틸리티로 생성됨)
- grading/ 폴더 존재 (채점 스크립트 포함)
- students/ 디렉터리 미존재

#### 테스트 단계
1. `python bootstrap.py` 실행
2. 로그 메시지 확인
3. students/ 디렉터리 구조 검증
4. 각 학생별 디렉터리 내용 확인

#### 예상 결과
```
students/
├── S20211001/
│   ├── repo/ (클론된 저장소)
│   └── grading/ (복사된 채점 폴더)
├── S20211002/
│   ├── repo/
│   └── grading/
├── S20211003/ (실패 - 프라이빗 저장소)
├── S20211004/ (실패 - 존재하지 않는 저장소)
└── S20211005/
    ├── repo/
    └── grading/
```

#### 성공 기준
- [ ] 유효한 저장소는 성공적으로 클론됨
- [ ] grading/ 폴더가 모든 학생 디렉터리에 복사됨
- [ ] 실패한 클론에 대한 적절한 로그 메시지
- [ ] 이미 존재하는 디렉터리는 건너뛰기

### TC002: Git 풀 기능 테스트

#### 목적
모든 학생 저장소에서 git pull이 올바르게 수행되는지 검증

#### 전제 조건
- 부트스트랩 완료
- Git 저장소들에 새로운 커밋 존재

#### 테스트 단계
1. GitManager 인스턴스 생성
2. `update_all_repositories()` 실행
3. 각 저장소의 업데이트 결과 확인
4. 로그 파일 검증

#### 예상 결과
```python
{
    'test001': {'success': True, 'message': 'Already up to date.'},
    'test002': {'success': True, 'message': 'Fast-forward'},
    'test003': {'success': False, 'error': 'Authentication failed'},
    'test005': {'success': True, 'message': 'Merge made by recursive strategy'}
}
```

#### 성공 기준
- [ ] 접근 가능한 저장소는 성공적으로 업데이트됨
- [ ] 인증 실패는 적절히 처리됨
- [ ] 30초 타임아웃이 정상 작동
- [ ] 동시 작업 제한(5개)이 적용됨

### TC003: 채점 시스템 테스트

#### 목적
학생 코드 채점이 올바르게 수행되고 결과가 적절히 저장되는지 검증

#### 전제 조건
- 학생 디렉터리에 grading/ 폴더 존재
- 다양한 채점 시나리오용 테스트 코드 준비

#### 테스트 시나리오
1. **성공적인 채점**: pass 파일 생성
2. **실패한 채점**: fail 파일 생성
3. **타임아웃**: 30초 후 fail 파일 생성
4. **런타임 에러**: fail 파일 생성 및 로깅
5. **무한 루프**: 프로세스 종료 및 fail 생성

#### 테스트 단계
1. 각 시나리오별 grading/ 폴더의 스크립트 준비
2. Grader.grade_student() 실행
3. 결과 파일 확인 (pass/fail)
4. 로그 메시지 검증
5. 리소스 사용량 확인

#### 성공 기준
- [ ] 올바른 결과 파일이 생성됨 (pass/fail)
- [ ] 타임아웃이 정확히 30초에 발생
- [ ] 메모리 제한 (512MB)이 적용됨
- [ ] CPU 제한이 적용됨
- [ ] 에러 메시지가 적절히 로깅됨

### TC004: 스케줄러 통합 테스트

#### 목적
Git 업데이트와 채점이 주기적으로 자동 실행되는지 검증

#### 전제 조건
- config.yaml 설정 완료
- 테스트용 짧은 간격 설정 (pull_interval: 10초)

#### 테스트 단계
1. GradingScheduler 시작
2. 2분간 실행 상태 모니터링
3. 학생 상태 변화 추적
4. 메모리 사용량 모니터링
5. 스케줄러 중지

#### 예상 결과
- 10초마다 git pull 수행
- 성공한 pull 후 즉시 채점 실행
- student_states 딕셔너리 업데이트
- 메모리 누수 없음

#### 성공 기준
- [ ] 설정된 간격으로 작업 수행
- [ ] 각 학생의 상태가 정확히 추적됨
- [ ] 오류 발생 시 시스템 계속 실행
- [ ] 메모리 사용량 안정적 유지

---

## API 및 웹 인터페이스 테스트

### TC005: FastAPI 엔드포인트 테스트

#### 목적
모든 API 엔드포인트가 올바르게 작동하는지 검증

#### 테스트 케이스

##### TC005-1: 대시보드 페이지 (GET /)
```python
def test_dashboard_endpoint():
    response = client.get("/")
    assert response.status_code == 200
    assert "text/html" in response.headers["content-type"]
    assert "학생 실습 모니터링" in response.text
```

##### TC005-2: 상태 API (GET /api/status)
```python
def test_status_api():
    response = client.get("/api/status")
    assert response.status_code == 200
    data = response.json()

    # 필수 필드 확인
    for student_id, status in data.items():
        assert "status" in status
        assert "last_update" in status
        assert status["status"] in ["pass", "fail", "unknown"]
```

##### TC005-3: 헬스 체크 (GET /health)
```python
def test_health_endpoint():
    response = client.get("/health")
    assert response.status_code == 200
    data = response.json()
    assert data["status"] == "healthy"
    assert "timestamp" in data
```

#### 성공 기준
- [ ] 모든 엔드포인트가 올바른 상태 코드 반환
- [ ] JSON 응답 형식이 명세와 일치
- [ ] HTML 응답에 필수 요소 포함

### TC006: 웹소켓 연결 테스트

#### 목적
실시간 업데이트를 위한 웹소켓 연결이 안정적으로 작동하는지 검증

#### 테스트 단계
1. 웹소켓 클라이언트 연결
2. 학생 상태 변경 시뮬레이션
3. 실시간 메시지 수신 확인
4. 연결 해제 및 재연결 테스트
5. 다중 클라이언트 연결 테스트

#### 테스트 코드 예시
```python
async def test_websocket_connection():
    with client.websocket_connect("/ws") as websocket:
        # 연결 확인
        websocket.send_text("ping")

        # 상태 업데이트 시뮬레이션
        # (실제로는 스케줄러가 broadcast_updates 호출)

        # 메시지 수신 확인
        data = websocket.receive_text()
        message = json.loads(data)
        assert "test001" in message
```

#### 성공 기준
- [ ] 웹소켓 연결이 정상적으로 설정됨
- [ ] 실시간 업데이트 메시지 수신
- [ ] 연결 해제 시 자동 재연결
- [ ] 다중 클라이언트 동시 지원

### TC007: 대시보드 UI 테스트

#### 목적
웹 대시보드가 모든 기능 요구사항을 충족하는지 검증

#### 테스트 환경
- 브라우저: Chrome, Firefox, Safari
- 화면 크기: 데스크톱, 태블릿, 모바일

#### 테스트 시나리오

##### TC007-1: 초기 로딩
1. 브라우저에서 http://localhost:8000 접속
2. 페이지 로딩 시간 측정
3. 학생 카드 표시 확인
4. 웹소켓 연결 상태 확인

##### TC007-2: 실시간 업데이트
1. 백엔드에서 학생 상태 변경
2. 자동 업데이트 확인 (새로고침 없이)
3. 색상 변경 확인 (녹색↔빨간색)
4. 타임스탬프 업데이트 확인

##### TC007-3: 반응형 디자인
1. 다양한 화면 크기에서 테스트
2. 모바일에서 터치 반응성 확인
3. 그리드 레이아웃 적응성 확인

#### 성공 기준
- [ ] 페이지 로딩 시간 < 1초
- [ ] 실시간 업데이트 지연 < 100ms
- [ ] 모든 화면 크기에서 정상 표시
- [ ] 접근성 요구사항 충족 (고대비 색상)

---

## 성능 테스트

### TC008: 확장성 테스트

#### 목적
100명 이상의 학생을 처리할 수 있는지 검증

#### 테스트 설정
- 학생 수: 150명
- 가상 Git 저장소 생성
- 부하 생성 도구 사용

#### 테스트 단계
1. 150명의 가상 학생 데이터 생성
2. 시스템 시작 및 초기화
3. 전체 업데이트 사이클 실행
4. 성능 메트릭 수집
5. 메모리 사용량 모니터링

#### 성능 기준
- [ ] 전체 업데이트 사이클 < 2분
- [ ] 메모리 사용량 < 500MB
- [ ] CPU 사용률 < 80%
- [ ] 대시보드 응답 시간 < 1초

### TC009: 부하 테스트

#### 목적
시스템이 지속적인 부하 하에서 안정적으로 작동하는지 검증

#### 테스트 시나리오
1. **지속 실행 테스트**: 24시간 연속 실행
2. **동시 접근 테스트**: 50개 동시 웹소켓 연결
3. **대용량 저장소 테스트**: 큰 크기의 Git 저장소 처리

#### 모니터링 항목
- 메모리 사용량 추이
- CPU 사용률 변화
- 네트워크 I/O
- 디스크 사용량
- 응답 시간 변화

#### 성공 기준
- [ ] 24시간 동안 메모리 누수 없음
- [ ] 시스템 크래시 없음
- [ ] 성능 저하 < 10%
- [ ] 모든 학생 상태 정확히 추적

---

## 오류 및 예외 상황 테스트

### TC010: 네트워크 장애 테스트

#### 목적
네트워크 문제 발생 시 시스템이 적절히 대응하는지 검증

#### 테스트 시나리오
1. **인터넷 연결 해제**: Git pull 실패 처리
2. **GitHub 서비스 장애**: 타임아웃 및 재시도
3. **DNS 문제**: 저장소 접근 실패

#### 테스트 단계
1. 정상 상태에서 시작
2. 네트워크 연결 차단
3. 시스템 응답 확인
4. 연결 복구 후 자동 회복 확인

#### 성공 기준
- [ ] 네트워크 오류 시 시스템 크래시 없음
- [ ] 적절한 오류 메시지 로깅
- [ ] 연결 복구 시 자동 재개
- [ ] 대시보드에 오류 상태 표시

### TC011: 저장소 문제 테스트

#### 목적
문제가 있는 Git 저장소에 대한 처리가 올바른지 검증

#### 테스트 케이스
1. **삭제된 저장소**: 404 오류 처리
2. **프라이빗 저장소**: 인증 실패 처리
3. **병합 충돌**: 충돌 해결 실패 처리
4. **손상된 저장소**: .git 디렉터리 손상

#### 예상 결과
- 문제 저장소는 fail 상태로 표시
- 다른 학생들 처리는 계속 진행
- 상세한 오류 로그 기록
- 주기적 재시도 수행

#### 성공 기준
- [ ] 개별 저장소 오류가 전체 시스템에 영향 없음
- [ ] 명확한 오류 분류 및 로깅
- [ ] 사용자에게 의미 있는 오류 정보 제공

### TC012: 채점 코드 오류 테스트

#### 목적
문제가 있는 학생 코드 실행 시 시스템 안정성 검증

#### 테스트 시나리오
1. **무한 루프**: CPU 집약적 코드
2. **메모리 폭탄**: 대용량 메모리 할당
3. **파일 시스템 접근**: 권한 없는 파일 조작
4. **네트워크 접근**: 외부 서버 연결 시도
5. **시스템 호출**: 위험한 시스템 명령 실행

#### 테스트 코드 예시
```python
# 무한 루프 테스트용 driver.py
while True:
    pass

# 메모리 폭탄 테스트용 driver.py
data = [0] * (1024 * 1024 * 1024)  # 1GB 메모리 할당

# 파일 시스템 접근 테스트용 driver.py
with open('/etc/passwd', 'r') as f:
    content = f.read()
```

#### 성공 기준
- [ ] 타임아웃으로 무한 루프 방지
- [ ] 메모리 제한으로 메모리 폭탄 방지
- [ ] 권한 제한으로 시스템 파일 보호
- [ ] 네트워크 격리로 외부 접근 차단

---

## 보안 테스트

### TC013: 샌드박스 보안 테스트

#### 목적
학생 코드 실행 환경의 보안이 적절히 구현되었는지 검증

#### 테스트 시나리오
1. **권한 에스컬레이션**: sudo 명령 실행 시도
2. **프로세스 조작**: 다른 프로세스 종료 시도
3. **시스템 정보 접근**: /proc, /sys 디렉터리 접근
4. **환경 변수 조작**: GITHUB_TOKEN 등 접근 시도

#### 성공 기준
- [ ] 모든 위험한 작업이 차단됨
- [ ] 시스템 보안에 영향 없음
- [ ] 적절한 권한 에러 메시지

### TC014: 인증 및 인가 테스트

#### 목적
GitHub 토큰 및 시스템 인증이 안전하게 처리되는지 검증

#### 테스트 항목
1. **토큰 보안**: 환경 변수로부터 안전한 로딩
2. **로그 보안**: 민감한 정보 로깅 방지
3. **대시보드 접근**: 기본 인증 (선택사항)

#### 성공 기준
- [ ] 토큰이 코드에 하드코딩되지 않음
- [ ] 로그에 민감한 정보 노출 없음
- [ ] 인증 실패 시 적절한 처리

---

## 데이터 무결성 테스트

### TC015: 결과 파일 관리 테스트

#### 목적
채점 결과가 정확하고 일관성 있게 관리되는지 검증

#### 테스트 시나리오
1. **중복 결과 파일**: pass와 fail 파일 동시 존재
2. **결과 파일 누락**: driver.py 실행 후 결과 파일 없음
3. **파일 권한 문제**: 읽기 전용 디렉터리

#### 성공 기준
- [ ] 항상 하나의 명확한 결과 상태
- [ ] 결과 파일 생성 실패 시 적절한 처리
- [ ] 이전 결과 파일 정리

### TC016: 상태 동기화 테스트

#### 목적
파일 시스템과 메모리 상태가 일치하는지 검증

#### 테스트 단계
1. 시스템 시작 및 초기 상태 확인
2. 파일 시스템에서 직접 결과 파일 수정
3. 시스템 재시작 없이 상태 동기화 확인
4. 웹소켓을 통한 업데이트 확인

#### 성공 기준
- [ ] 파일 시스템 변경사항이 정확히 반영됨
- [ ] 메모리 상태와 파일 상태 일치
- [ ] 대시보드에 정확한 상태 표시

---

## 종합 인수 테스트

### TC017: 엔드투엔드 시나리오 테스트

#### 목적
전체 시스템이 실제 사용 시나리오에서 올바르게 작동하는지 종합 검증

#### 시나리오: "새 학기 시작"
1. **초기 설정**:
   - 새로운 roster.csv 준비 (50명 학생)
   - 시스템 초기화 및 부트스트랩 실행
   - 대시보드 접속 확인

2. **일상 운영**:
   - 학생들이 과제 제출 (Git push 시뮬레이션)
   - 실시간 상태 업데이트 확인
   - 교수가 대시보드에서 진행상황 모니터링

3. **문제 상황 처리**:
   - 일부 학생의 저장소 접근 불가
   - 네트워크 일시 장애
   - 시스템 복구 및 정상화

4. **결과 확인**:
   - 모든 학생의 최종 상태 정확성
   - 로그 파일의 완전성
   - 성능 지표 충족

#### 성공 기준
- [ ] 전체 프로세스가 중단 없이 완료
- [ ] 모든 성능 요구사항 충족
- [ ] 사용자 경험이 만족스러움
- [ ] 시스템 안정성 확보

---

## 테스트 실행 가이드

### 자동화된 테스트 실행
```bash
# 전체 테스트 스위트 실행
python -m pytest tests/ -v

# 특정 테스트 카테고리만 실행
python -m pytest tests/test_functional.py -v
python -m pytest tests/test_performance.py -v
python -m pytest tests/test_security.py -v

# 커버리지 리포트 포함
python -m pytest tests/ --cov=backend --cov=frontend --cov-report=html
```

### 수동 테스트 체크리스트
- [ ] 브라우저에서 대시보드 접속 및 기능 확인
- [ ] 다양한 디바이스에서 반응형 디자인 테스트
- [ ] 네트워크 차단 후 복구 시나리오 테스트
- [ ] 장시간 실행 안정성 테스트

### 테스트 결과 문서화
각 테스트 실행 후 다음 정보를 기록:
- 테스트 실행 날짜 및 시간
- 테스트 환경 정보 (OS, Python 버전 등)
- 성공/실패 상태 및 상세 결과
- 성능 메트릭 (실행 시간, 메모리 사용량 등)
- 발견된 이슈 및 개선사항

### 인수 기준 충족 확인
시스템이 다음 모든 기준을 충족해야 최종 인수 승인:
- [ ] 모든 기능 테스트 통과
- [ ] 성능 요구사항 충족
- [ ] 보안 테스트 통과
- [ ] 24시간 안정성 테스트 통과
- [ ] 사용자 인터페이스 요구사항 충족
- [ ] 문서화 완료